# TODO: install new ppa for getting latest php stuff

# TODO: install 5.4

- name: install php5-dev
  apt: pkg=php5-dev
  notify:
    - restart php5-fpm

- name: add php.ini files
  copy: src=common/files/php.${item}.ini dest=/etc/php5/${item}/php.ini
  with_items:
    - cli
    - fpm
    - apache2
  ignore_errors: true # because apache and/or php-fpm may or may not be installed on the target machine
  
- name: install PHP xmlrpc module
  apt: pkg=php5-xmlrpc
  notify:
    - restart php5-fpm

- name: install PHP mysql driver
  apt: pkg=php5-mysql
  notify:
    - restart php5-fpm

- name: install php5-cli
  apt: pkg=php5-cli

- name: install composer
  shell: curl -s http://getcomposer.org/installer | php --install-dir=/usr/local/bin creates=/usr/local/bin/composer

# TODO: ensure proper mongo.so for php 5.4
- name: install php mongo
  shell: pecl install mongo creates=/usr/lib/php5/20090626/mongo.so

- name: update php.ini configs to load mongo extension
  lineinfile: dest=/etc/php5/${item}/php.ini regexp="^extension=mongo.so" line=extension=mongo.so
  with_items: 
    - apache2
    - fpm
    - cli
  notify:
    - restart php5-fpm
    - restart apache
  ignore_errors: true   # because apache and/or php-fpm may or may not be installed on the target machine

