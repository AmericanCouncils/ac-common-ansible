- include: install_php7_fpm.yml

- include: ferm_allow_global_port.yml
  vars:
    port: "{{web_port|default(80)}}"
  when: "not dockerized"

- include: symfony_app_user.yml
  vars:
    user: vagrant
    poolname: "{{name}}"

- name: set composer vendor dir environment variable
  lineinfile: dest=/home/vagrant/.bashrc
              regexp="^export COMPOSER_VENDOR_DIR="
              line="export COMPOSER_VENDOR_DIR=/home/vagrant/vendor"

- name: set composer bin dir environment variable
  lineinfile: dest=/home/vagrant/.bashrc
              regexp="^export COMPOSER_BIN_DIR="
              line="export COMPOSER_BIN_DIR=/home/vagrant/bin"

- include: init_symfony_app.yml
  vars:
    dir: "/home/vagrant/vendor"

- name: symfony_dev_server - update ownership of files generated by composer
  file: path="/home/vagrant"
        state=directory
        recurse=yes
        owner=vagrant
        group=vagrant

- include: nginx_app_config.yml
  vars:
    # Passing through variable: name
    template: common/templates/symfony-dev-nginx.j2
    root: "{{dir}}/web"
    symfony_devmode: "{{!test_env|default(true)}}"
    symfony_testmode: "{{test_env|default(false)}}"
    port: "{{web_port|default(80)}}"
