- name: install build-essential for building native ruby gems
  apt: pkg=build-essential

- name: install cmake for building native ruby gems
  apt: pkg=cmake

- name: install MySQL libraries for building mysql client gems
  apt: pkg=libmysqlclient-dev

- name: install SQLite3 libraries for building mysql client gems
  apt: pkg=libsqlite3-dev

- name: Install rbenv using curl as user vagrant
  shell: curl -fsSL https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer | bash
  become_user: vagrant  
  environment:  
    HOME: "/home/vagrant"

- name: update ownership of files generated by rbenv
  file: path="/home/vagrant/.rbenv"
        state=directory
        recurse=yes
        owner=vagrant
        group=vagrant

# - name: Add rbenv init to bashrc
#   shell: echo 'eval "(/home/vagrant/.rbenv/bin/rbenv init - sh)" >> ~/.bashrc'
#   become_user: vagrant  
#   environment:  
#     HOME: "/home/vagrant"

- name: install ruby with rbenv
  shell: /home/vagrant/.rbenv/bin/rbenv install 2.4.10
  ignore_errors: true # :/
  become_user: vagrant 
  environment:  
    HOME: "/home/vagrant"

- name: set Ruby version to global
  shell: /home/vagrant/.rbenv/bin/rbenv global 2.4.10
  become_user: vagrant  
  environment:  
    HOME: "/home/vagrant"

- name: Add path for rbenv 
  command: echo 'export PATH="/home/vagrant/.rbenv/bin:$PATH"' >> /home/vagrant/.bashrc

- name: Add init command for rbenv 
  command: echo 'eval "$(rbenv init -sh)"' >> /home/vagrant/.bashrc
  
- name: install shared-mime-info
  apt: pkg=shared-mime-info
  tags: install_ruby

- name: install bundler gem
  shell: /home/vagrant/.rbenv/versions/2.4.10/bin/gem install bundler -v 1.15.0
  become_user: vagrant  
  environment:  
    HOME: "/home/vagrant"  


